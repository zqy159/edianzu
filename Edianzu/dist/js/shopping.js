"use strict";function common(){this.local=window.localStorage,this.sum=$("#sum")}function shoppingHtml(t,s){this.data=t,this.local=s,this.box_wrapper=$("#box_wrapper")}function shopping(){this.main=$("#main"),this.all=$("#all"),this.rall=$("#rall"),this.checkMin=$(".check"),this.increase=$(".increase"),this.result=0,this.price=$(".k"),this.cum=$(".n"),this.sumprice=$("#sumPrice"),this.del=$(".del"),this.sum=$("#sum"),this.local=window.localStorage,this.m=JSON.parse(this.local.date)}$.extend(common.prototype,{init:function(){0!=this.local.length?this.sum.html(this.local.sum):this.sum.html(0)}}),$.extend(shoppingHtml.prototype,{init:function(){for(var t in JSON.parse(this.local.date)){var s=t.split("-")[1],i=6*(t.split("-")[2]-1)+parseInt(t.split("-")[3]-1);this.box_wrapper.append('\n\t\t\t<div id="box" data-id="'+this.data[s][i].id+'">\n\t\t\t<input type="checkbox" checked="checked" class=\'check\'>\n\t\t\t<img src="../'+this.data[s][i].img+'" alt="">\n\t\t\t<a href="#">'+this.data[s][i].txt+'</a>\n\t\t\t<span>¥ 203</span>\n\t\t\t<span class="k">'+this.data[s][i].price+'</span>\n\t\t\t<span class="select">\n\t\t\t\t<button class="decrease">-</button>\n\t\t\t\t<input type="text" value="'+JSON.parse(this.local.date)[t]+'" id="mum" class="n">\n\t\t\t\t<button class="increase">+</button>\n\t\t\t</span>\n\t\t\t<span><a href="#" class="del">删除</a><br/>\n\t\t\t\t<a href="#" class="col">转到我的收藏</a>\n\t\t\t</span>\n\t\t</div>\n\t\t</div>\n\t\t\t')}}}),$.extend(shopping.prototype,{init:function(){this.btn(),this.sumPrice(),this.sum.html(this.local.sum)},sumPrice:function(){for(var t=this.result=0;t<this.cum.length;t++)this.checkMin.eq(t).prop("checked")&&(this.result+=parseInt(this.cum.eq(t).val()*this.price.eq(t).html().slice(1)));this.sumprice.html("￥"+this.result)},btn:function(){this.main.on("click",$.proxy(this.btns,this))},btns:function(t){var s=this,i=t.target;if(this.checkMin=$(".check"),this.targetId=$(i).parent().parent().attr("data-id"),"all"==i.id&&(this.checkMin.prop({checked:!!this.all.prop("checked")}),this.rall.prop({checked:!1})),"rall"==i.id){for(var e=0;e<this.checkMin.length;e++)this.checkMin.eq(e).prop({checked:!this.checkMin.eq(e).prop("checked")});this.all.prop({checked:!1})}if("check"==i.className)for(var a=0;a<this.checkMin.length;a++){if(!this.checkMin[a].checked){$("#all").prop({checked:!1});break}$("#all").prop({checked:!0}),this.rall.prop({checked:!1})}if("mum"==i.id&&$(i).on("blur",function(){s.m[s.targetId]=$(i).val()}),"increase"==i.className){var c=$(i).prev().val();c++,this.m[this.targetId]++,$(i).prev().val(c)}if("decrease"==i.className){var n=$(i).next().val();n<=1?n=1:(n--,this.m[this.targetId]--),$(i).next().val(n)}for(var h in"del"==i.className&&(delete this.m[this.targetId],$(i).parent().parent().remove(),this.cum=$(".n"),this.price=$(".k")),this.local.sum=0,this.m)this.local.sum=parseInt(this.local.sum)+parseInt(this.m[h]);this.sumPrice(),this.sum.html(this.local.sum),this.local.date=JSON.stringify(this.m)}});var p1=new Promise(function(s,t){$.ajax({url:"../js/product.json",dataType:"json",success:function(t){s(t)}})});p1.then(function(t){var s=window.localStorage;0!=s.length?(new shoppingHtml(t,s).init(),(new shopping).init()):alert("购物车空空如也，你要是够了!")});